
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brain Training Games</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 1000px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #333;
            font-size: 2.5em;
            margin-bottom: 15px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            font-size: 1.2em;
            margin-bottom: 40px;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        .game-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .game-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 15px;
            padding: 40px 20px;
            color: white;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .game-card:hover:not(:disabled) {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .game-card:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: linear-gradient(135deg, #999 0%, #666 100%);
        }

        .game-card.available {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .back-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1em;
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.2s;
            margin-bottom: 20px;
        }

        .back-btn:hover {
            background: #5a6268;
        }

        /* Photo Upload Styles */
        .upload-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .upload-instructions {
            text-align: center;
            font-size: 1.2em;
            color: #333;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .photo-upload-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .photo-slot {
            border: 3px dashed #667eea;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
            position: relative;
            overflow: visible;
        }

        .photo-slot:hover {
            border-color: #764ba2;
            transform: scale(1.05);
        }

        .photo-slot.filled {
            border-style: solid;
            border-color: #11998e;
        }

        .photo-preview {
            aspect-ratio: 1;
            width: 100%;
            overflow: hidden;
            border-radius: 12px 12px 0 0;
        }

        .photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-label-input {
            width: 100%;
            padding: 10px;
            border: none;
            border-top: 2px solid #e0e0e0;
            font-size: 1em;
            text-align: center;
            border-radius: 0 0 12px 12px;
            background: #f8f9fa;
        }

        .photo-label-input:focus {
            outline: none;
            background: white;
        }

        .photo-slot-content {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: #667eea;
            font-size: 1em;
            flex-direction: column;
        }

        .photo-slot-content .icon {
            font-size: 2.5em;
            margin-bottom: 5px;
        }

        .remove-photo {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 0, 0, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 1.2em;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .photo-slot.filled:hover .remove-photo {
            display: flex;
        }

        .mode-selector {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .mode-btn {
            background: white;
            border: 3px solid #667eea;
            color: #667eea;
            padding: 15px 30px;
            font-size: 1.1em;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .mode-btn:hover {
            transform: translateY(-2px);
        }

        .difficulty-selector {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
        }

        .difficulty-label {
            text-align: center;
            font-size: 1.2em;
            color: #333;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .difficulty-options {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .difficulty-btn {
            background: white;
            border: 3px solid #667eea;
            color: #667eea;
            padding: 12px 25px;
            font-size: 1em;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
        }

        .difficulty-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .save-load-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
        }

        .save-load-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .save-btn, .load-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1em;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
        }

        .load-btn {
            background: #17a2b8;
        }

        .save-btn:hover {
            background: #218838;
        }

        .load-btn:hover {
            background: #138496;
        }

        /* Memory Game Styles */
        .game-info {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .info-item {
            text-align: center;
        }

        .info-label {
            font-size: 1em;
            color: #666;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 2em;
            font-weight: bold;
            color: #333;
        }

        .sound-toggle {
            background: #ffc107;
            color: #333;
            border: none;
            padding: 10px 20px;
            font-size: 1em;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .sound-toggle:hover {
            background: #ffca2c;
        }

        .memory-grid {
            display: grid;
            gap: 15px;
            margin-bottom: 30px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .memory-card {
            aspect-ratio: 1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 15px;
            font-size: 3em;
            cursor: pointer;
            transition: transform 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }

        .memory-card:hover:not(:disabled) {
            transform: scale(1.05);
        }

        .memory-card.flipped {
            background: white;
            border: 3px solid #667eea;
        }

        .memory-card.matched {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            cursor: default;
        }

        .memory-card:disabled {
            cursor: default;
        }

        .memory-card img {
            width: 90%;
            height: 90%;
            object-fit: cover;
            display: none;
            border-radius: 10px;
        }

        .memory-card.flipped img,
        .memory-card.matched img {
            display: block;
        }

        .card-label {
            display: none;
            position: absolute;
            bottom: 5px;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px;
            font-size: 0.4em;
            text-align: center;
            border-radius: 0 0 10px 10px;
        }

        .memory-card.flipped .card-label,
        .memory-card.matched .card-label {
            display: block;
        }

        /* Word Search Styles */
        .game-content {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
        }

        .word-grid-container {
            flex: 1;
        }

        .word-grid {
            display: grid;
            gap: 5px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin: 0 auto;
            max-width: 500px;
        }

        .word-cell {
            aspect-ratio: 1;
            background: white;
            border: 2px solid #667eea;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }

        .word-cell:hover {
            background: #f0f0ff;
            transform: scale(1.1);
        }

        .word-cell.selected {
            background: #667eea;
            color: white;
        }

        .word-cell.found {
            background: #11998e;
            color: white;
            border-color: #11998e;
        }

        .words-panel {
            flex: 0 0 300px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            max-height: 600px;
            overflow-y: auto;
        }

        .words-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .word-list {
            list-style: none;
        }

        .word-item {
            padding: 12px;
            margin-bottom: 10px;
            background: white;
            border-radius: 8px;
            transition: all 0.3s;
            border: 2px solid transparent;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .word-item img {
            width: 40px;
            height: 40px;
            object-fit: cover;
            border-radius: 50%;
            border: 2px solid #667eea;
        }

        .word-item-text {
            flex: 1;
            font-size: 1.2em;
            font-weight: bold;
            text-align: center;
        }

        .word-item.found {
            background: #11998e;
            color: white;
            text-decoration: line-through;
        }

        .word-item.found img {
            border-color: white;
            opacity: 0.7;
        }

        .theme-selector {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
        }

        .theme-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .theme-btn {
            background: white;
            border: 3px solid #667eea;
            color: #667eea;
            padding: 15px;
            font-size: 1em;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
        }

        .theme-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s;
            font-weight: bold;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .congratulations {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            border-radius: 15px;
            color: white;
            margin-bottom: 20px;
        }

        .congratulations h2 {
            font-size: 2.5em;
            margin-bottom: 15px;
        }

        .congratulations p {
            font-size: 1.5em;
        }

        @media (max-width: 768px) {
            .game-content {
                flex-direction: column;
            }

            .words-panel {
                flex: 1;
                max-height: none;
            }

            h1 {
                font-size: 2em;
            }

            .word-cell {
                font-size: 1.2em;
            }

            .memory-card {
                font-size: 2em;
            }

            .photo-upload-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Home Screen -->
        <div id="homeScreen" class="screen active">
            <h1>üß† Brain Training Games</h1>
            <p class="subtitle">Choose a game to exercise your mind</p>
            
            <div class="game-grid">
                <button class="game-card available" onclick="showGame('memory')">
                    üé¥<br>Memory Matching
                </button>
                <button class="game-card available" onclick="showGame('wordsearch')">
                    üìù<br>Word Search
                </button>
                <button class="game-card" disabled>
                    üî¢<br>Pattern Recognition<br><small>(Coming Soon)</small>
                </button>
                <button class="game-card" disabled>
                    üÉè<br>Solitaire<br><small>(Coming Soon)</small>
                </button>
            </div>
        </div>

        <!-- Memory Game Setup Screen -->
        <div id="memorySetupScreen" class="screen">
            <button class="back-btn" onclick="showHome()">‚Üê Back to Games</button>
            
            <h1>üé¥ Memory Matching Setup</h1>
            <p class="subtitle">Choose your game mode</p>

            <div class="mode-selector">
                <button class="mode-btn active" onclick="setMemoryMode('emoji')" id="emojiModeBtn">
                    üòä Play with Emojis
                </button>
                <button class="mode-btn" onclick="setMemoryMode('photos')" id="photoModeBtn">
                    üì∑ Play with Photos
                </button>
            </div>

            <div class="difficulty-selector">
                <div class="difficulty-label">Choose Difficulty Level</div>
                <div class="difficulty-options">
                    <button class="difficulty-btn active" onclick="setMemoryDifficulty('easy')" id="memEasyBtn">
                        Easy (4 pairs)
                    </button>
                    <button class="difficulty-btn" onclick="setMemoryDifficulty('medium')" id="memMediumBtn">
                        Medium (6 pairs)
                    </button>
                </div>
            </div>

            <div id="photoUploadSection" class="upload-section" style="display: none;">
                <div class="upload-instructions">
                    üì∏ Upload photos of family members, pets, or favorite things!<br>
                    <small>You need at least <span id="memMinPhotos">4</span> photos to start playing</small>
                </div>
                
                <div class="photo-upload-grid" id="photoGrid">
                    <!-- Photo slots will be generated here -->
                </div>
                
                <div style="text-align: center; margin-top: 15px; color: #666;">
                    <strong>Photos uploaded: <span id="photoCount">0</span>/<span id="memMaxPhotos">4</span></strong>
                </div>

                <div class="save-load-section">
                    <div class="save-load-buttons">
                        <button class="save-btn" onclick="saveMemoryPhotoSet()">üíæ Save Photo Set</button>
                        <button class="load-btn" onclick="loadMemoryPhotoSet()">üìÇ Load Photo Set</button>
                    </div>
                </div>
            </div>

            <div class="controls">
                <button class="btn" onclick="startMemoryGame()" id="startMemoryBtn">Start Game</button>
            </div>
        </div>

        <!-- Memory Game Screen -->
        <div id="memoryScreen" class="screen">
            <button class="back-btn" onclick="backToMemorySetup()">‚Üê Back to Setup</button>
            
            <h1>üé¥ Memory Matching</h1>
            <p class="subtitle">Find all the matching pairs!</p>

            <div style="text-align: center;">
                <button class="sound-toggle" onclick="toggleSound()" id="soundToggle">
                    üîä Sound: ON
                </button>
            </div>

            <div id="memCongrats" class="congratulations" style="display: none;">
                <h2>üéâ Congratulations!</h2>
                <p>You found all pairs in <span id="finalMoves">0</span> moves!</p>
            </div>

            <div class="game-info">
                <div class="info-item">
                    <div class="info-label">Moves</div>
                    <div class="info-value" id="moves">0</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Pairs Found</div>
                    <div class="info-value" id="pairs">0 / 4</div>
                </div>
            </div>

            <div class="memory-grid" id="memoryGrid"></div>

            <div class="controls">
                <button class="btn" onclick="restartMemoryGame()">New Game</button>
                <button class="btn" onclick="backToMemorySetup()">Change Settings</button>
            </div>
        </div>

        <!-- Word Search Setup Screen -->
        <div id="wordSearchSetupScreen" class="screen">
            <button class="back-btn" onclick="showHome()">‚Üê Back to Games</button>
            
            <h1>üìù Word Search Setup</h1>
            <p class="subtitle">Customize your game</p>

            <div class="mode-selector">
                <button class="mode-btn active" onclick="setWordMode('theme')" id="themeModeBtn">
                    üé® Play with Themes
                </button>
                <button class="mode-btn" onclick="setWordMode('photos')" id="photoWordModeBtn">
                    üì∑ Play with Photos
                </button>
            </div>

            <div class="difficulty-selector">
                <div class="difficulty-label">Choose Difficulty Level</div>
                <div class="difficulty-options">
                    <button class="difficulty-btn active" onclick="setWordDifficulty('easy')" id="wordEasyBtn">
                        Easy (6x6 grid, 4 words)
                    </button>
                    <button class="difficulty-btn" onclick="setWordDifficulty('medium')" id="wordMediumBtn">
                        Medium (8x8 grid, 6 words)
                    </button>
                </div>
            </div>

            <div id="themeSection" class="theme-selector">
                <div class="difficulty-label">Choose Theme</div>
                <div class="theme-options">
                    <button class="theme-btn active" onclick="setTheme('animals')" id="themeAnimals">
                        üêæ Animals
                    </button>
                    <button class="theme-btn" onclick="setTheme('fruits')" id="themeFruits">
                        üçé Fruits
                    </button>
                    <button class="theme-btn" onclick="setTheme('family')" id="themeFamily">
                        üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family
                    </button>
                    <button class="theme-btn" onclick="setTheme('nature')" id="themeNature">
                        üå≥ Nature
                    </button>
                </div>
            </div>

            <div id="photoWordSection" class="upload-section" style="display: none;">
                <div class="upload-instructions">
                    üì∏ Upload photos of family, friends, or pets and add their names!<br>
                    <small>Names will be hidden in the word search puzzle</small>
                </div>
                
                <div class="photo-upload-grid" id="wordPhotoGrid">
                    <!-- Photo slots will be generated here -->
                </div>
                
                <div style="text-align: center; margin-top: 15px; color: #666;">
                    <strong>Photos uploaded: <span id="wordPhotoCount">0</span>/<span id="maxWordPhotos">4</span></strong>
                </div>

                <div class="save-load-section">
                    <div class="save-load-buttons">
                        <button class="save-btn" onclick="saveWordPhotoSet()">üíæ Save Photo Set</button>
                        <button class="load-btn" onclick="loadWordPhotoSet()">üìÇ Load Photo Set</button>
                    </div>
                </div>
            </div>

            <div class="controls">
                <button class="btn" onclick="startWordSearch()" id="startWordBtn">Start Game</button>
            </div>
        </div>

        <!-- Word Search Game Screen -->
        <div id="wordSearchScreen" class="screen">
            <button class="back-btn" onclick="backToWordSetup()">‚Üê Back to Setup</button>
            
            <h1>üìù Word Search</h1>
            <p class="subtitle">Find all the words!</p>

            <div id="wordCongrats" class="congratulations" style="display: none;">
                <h2>üéâ Excellent Work!</h2>
                <p>You found all <span id="totalWords">0</span> words!</p>
            </div>

            <div class="game-info">
                <div class="info-item">
                    <div class="info-label">Words Found</div>
                    <div class="info-value"><span id="wordsFound">0</span> / <span id="totalWordsDisplay">0</span></div>
                </div>
            </div>

            <div class="game-content">
                <div class="word-grid-container">
                    <div class="word-grid" id="wordGrid"></div>
                </div>
                <div class="words-panel">
                    <div class="words-title">Find These Words:</div>
                    <ul class="word-list" id="wordList"></ul>
                </div>
            </div>

            <div class="controls">
                <button class="btn" onclick="startWordSearch()">New Game</button>
                <button class="btn" onclick="backToWordSetup()">Change Settings</button>
            </div>
        </div>
    </div>

    <script>
        // ===== MEMORY GAME =====
        let memoryMode = 'emoji';
        let memoryDifficulty = 'easy';
        let uploadedPhotos = [];
        let soundEnabled = true;
        const symbols = ['üåü', 'üåà', 'üå∫', 'ü¶ã', 'üé®', 'üé≠', 'üé™', 'üéØ'];
        let cards = [];
        let flippedCards = [];
        let moves = 0;
        let matchedPairs = 0;
        let canFlip = true;
        let totalPairs = 4;

        // ===== WORD SEARCH GAME =====
        let wordMode = 'theme';
        let wordDifficulty = 'easy';
        let wordTheme = 'animals';
        let gridSize = 6;
        let grid = [];
        let words = [];
        let wordPhotos = [];
        let uploadedWordPhotos = [];
        let foundWords = [];
        let selectedCells = [];
        let isSelecting = false;

        const themes = {
            animals: ['CAT', 'DOG', 'BIRD', 'FISH', 'LION', 'BEAR', 'DEER', 'FROG'],
            fruits: ['APPLE', 'GRAPE', 'PEAR', 'PLUM', 'LEMON', 'MELON', 'BERRY', 'PEACH'],
            family: ['MOM', 'DAD', 'SON', 'AUNT', 'UNCLE', 'SISTER', 'COUSIN'],
            nature: ['TREE', 'LEAF', 'RAIN', 'SUN', 'MOON', 'STAR', 'CLOUD', 'WIND']
        };

        // ===== SOUND =====
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(type) {
            if (!soundEnabled) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            if (type === 'flip') {
                oscillator.frequency.value = 400;
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            } else if (type === 'match') {
                oscillator.frequency.value = 600;
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            } else if (type === 'win') {
                const frequencies = [523, 659, 784, 1047];
                frequencies.forEach((freq, i) => {
                    const osc = audioContext.createOscillator();
                    const gain = audioContext.createGain();
                    osc.connect(gain);
                    gain.connect(audioContext.destination);
                    osc.frequency.value = freq;
                    gain.gain.setValueAtTime(0.1, audioContext.currentTime + i * 0.1);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.1 + 0.2);
                    osc.start(audioContext.currentTime + i * 0.1);
                    osc.stop(audioContext.currentTime + i * 0.1 + 0.2);
                });
            }
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('soundToggle').textContent = soundEnabled ? 'üîä Sound: ON' : 'üîá Sound: OFF';
        }

        // ===== NAVIGATION =====
        function showGame(game) {
            document.getElementById('homeScreen').classList.remove('active');
            if (game === 'memory') {
                document.getElementById('memorySetupScreen').classList.add('active');
                updateMemoryPhotoSlots();
            } else if (game === 'wordsearch') {
                document.getElementById('wordSearchSetupScreen').classList.add('active');
                updateWordPhotoSlots();
            }
        }

        function showHome() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('homeScreen').classList.add('active');
        }

        function backToMemorySetup() {
            document.getElementById('memoryScreen').classList.remove('active');
            document.getElementById('memorySetupScreen').classList.add('active');
        }

        function backToWordSetup() {
            document.getElementById('wordSearchScreen').classList.remove('active');
            document.getElementById('wordSearchSetupScreen').classList.add('active');
        }

        // ===== MEMORY GAME SETUP =====
        function setMemoryMode(mode) {
            memoryMode = mode;
            document.getElementById('emojiModeBtn').classList.toggle('active', mode === 'emoji');
            document.getElementById('photoModeBtn').classList.toggle('active', mode === 'photos');
            
            document.getElementById('photoUploadSection').style.display = mode === 'photos' ? 'block' : 'none';
            updateStartMemoryButton();
        }

        function setMemoryDifficulty(level) {
            memoryDifficulty = level;
            document.getElementById('memEasyBtn').classList.toggle('active', level === 'easy');
            document.getElementById('memMediumBtn').classList.toggle('active', level === 'medium');
            updateMemoryPhotoSlots();
            updateStartMemoryButton();
        }

        function updateMemoryPhotoSlots() {
            const maxPhotos = memoryDifficulty === 'easy' ? 4 : 6;
            document.getElementById('memMaxPhotos').textContent = maxPhotos;
            document.getElementById('memMinPhotos').textContent = maxPhotos;
            
            const grid = document.getElementById('photoGrid');
            grid.innerHTML = '';
            
            for (let i = 0; i < maxPhotos; i++) {
                const slot = document.createElement('div');
                slot.className = 'photo-slot';
                
                if (uploadedPhotos[i]?.image) {
                    slot.classList.add('filled');
                    slot.innerHTML = `
                        <div class="photo-preview">
                            <img src="${uploadedPhotos[i].image}" alt="Photo ${i + 1}">
                        </div>
                        <input type="text" class="photo-label-input" placeholder="Add name..." 
                               value="${uploadedPhotos[i].label || ''}" 
                               onchange="updateMemoryPhotoLabel(${i}, this.value)"
                               onclick="event.stopPropagation()">
                        <button class="remove-photo" onclick="removeMemoryPhoto(${i})">√ó</button>
                    `;
                } else {
                    slot.innerHTML = `
                        <div class="photo-slot-content">
                            <div class="icon">üì∑</div>
                            <div>Add Photo ${i + 1}</div>
                        </div>
                    `;
                }
                
                slot.onclick = () => triggerMemoryFileUpload(i);
                grid.appendChild(slot);
            }
            updateMemoryPhotoCount();
        }

        function triggerMemoryFileUpload(index) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = (e) => handleMemoryPhotoUpload(e, index);
            input.click();
        }

        function handleMemoryPhotoUpload(event, index) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                while (uploadedPhotos.length <= index) {
                    uploadedPhotos.push(null);
                }
                if (!uploadedPhotos[index]) {
                    uploadedPhotos[index] = {};
                }
                uploadedPhotos[index].image = e.target.result;
                updateMemoryPhotoSlots();
                updateStartMemoryButton();
            };
            reader.readAsDataURL(file);
        }

        function updateMemoryPhotoLabel(index, label) {
            while (uploadedPhotos.length <= index) {
                uploadedPhotos.push(null);
            }
            if (!uploadedPhotos[index]) {
                uploadedPhotos[index] = {};
            }
            uploadedPhotos[index].label = label;
            updateMemoryPhotoSlots();
        }

        function removeMemoryPhoto(index) {
            event.stopPropagation();
            while (uploadedPhotos.length <= index) {
                uploadedPhotos.push(null);
            }
            uploadedPhotos[index] = null;
            updateMemoryPhotoSlots();
            updateStartMemoryButton();
        }

        function updateMemoryPhotoCount() {
            const count = uploadedPhotos.filter(p => p?.image).length;
            document.getElementById('photoCount').textContent = count;
        }

        function updateStartMemoryButton() {
            const btn = document.getElementById('startMemoryBtn');
            const requiredPhotos = memoryDifficulty === 'easy' ? 4 : 6;
            
            if (memoryMode === 'photos') {
                const photoCount = uploadedPhotos.filter(p => p?.image).length;
                btn.disabled = photoCount < requiredPhotos;
                btn.textContent = photoCount < requiredPhotos ? 
                    `Upload ${requiredPhotos} photos to start` : 'Start Game';
            } else {
                btn.disabled = false;
                btn.textContent = 'Start Game';
            }
        }

        function saveMemoryPhotoSet() {
            const validPhotos = uploadedPhotos.filter(p => p?.image);
            if (validPhotos.length === 0) {
                alert('Please upload some photos first!');
                return;
            }
            
            try {
                const dataStr = JSON.stringify(uploadedPhotos);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'memory-game-photos.json';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                alert('Photo set saved successfully! Check your downloads folder.');
            } catch (error) {
                alert('Error saving photo set: ' + error.message);
            }
        }

        function loadMemoryPhotoSet() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        uploadedPhotos = data;
                        updateMemoryPhotoSlots();
                        updateStartMemoryButton();
                        alert('Photo set loaded successfully!');
                    } catch (error) {
                        alert('Error loading photo set: ' + error.message);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // ===== MEMORY GAME LOGIC =====
        function startMemoryGame() {
            document.getElementById('memorySetupScreen').classList.remove('active');
            document.getElementById('memoryScreen').classList.add('active');
            initMemoryGame();
        }

        function restartMemoryGame() {
            initMemoryGame();
        }

        function initMemoryGame() {
            moves = 0;
            matchedPairs = 0;
            flippedCards = [];
            canFlip = true;
            document.getElementById('memCongrats').style.display = 'none';

            totalPairs = memoryDifficulty === 'easy' ? 4 : 6;

            let gameItems;
            if (memoryMode === 'photos') {
                const validPhotos = uploadedPhotos.filter(p => p?.image);
                gameItems = validPhotos.slice(0, totalPairs);
            } else {
                gameItems = symbols.slice(0, totalPairs).map(s => ({ image: s, label: '' }));
            }

            document.getElementById('moves').textContent = '0';
            document.getElementById('pairs').textContent = `0 / ${totalPairs}`;

            cards = [...gameItems, ...gameItems]
                .map((item, index) => ({ item, id: index, type: memoryMode }))
                .sort(() => Math.random() - 0.5);

            const grid = document.getElementById('memoryGrid');
            grid.innerHTML = '';
            grid.style.gridTemplateColumns = 'repeat(4, 1fr)';
            
            cards.forEach((card, index) => {
                const cardEl = document.createElement('button');
                cardEl.className = 'memory-card';
                cardEl.dataset.index = index;
                
                if (card.type === 'photos') {
                    const img = document.createElement('img');
                    img.src = card.item.image;
                    cardEl.appendChild(img);
                    
                    if (card.item.label) {
                        const label = document.createElement('div');
                        label.className = 'card-label';
                        label.textContent = card.item.label;
                        cardEl.appendChild(label);
                    }
                } else {
                    cardEl.dataset.symbol = card.item.image;
                }
                
                cardEl.onclick = () => flipCard(index);
                grid.appendChild(cardEl);
            });
        }

        function flipCard(index) {
            if (!canFlip) return;
            
            const cardEl = document.querySelectorAll('.memory-card')[index];
            
            if (cardEl.classList.contains('matched') || 
                cardEl.classList.contains('flipped') ||
                flippedCards.length >= 2) {
                return;
            }

            playSound('flip');
            cardEl.classList.add('flipped');
            if (cards[index].type === 'emoji') {
                cardEl.textContent = cards[index].item.image;
            }
            
            flippedCards.push({ 
                index, 
                item: cards[index].item, 
                element: cardEl,
                type: cards[index].type
            });

            if (flippedCards.length === 2) {
                moves++;
                document.getElementById('moves').textContent = moves;
                canFlip = false;

                const match = (flippedCards[0].type === 'photos') ?
                    (flippedCards[0].item.image === flippedCards[1].item.image) :
                    (flippedCards[0].item.image === flippedCards[1].item.image);

                if (match) {
                    setTimeout(() => {
                        playSound('match');
                        flippedCards.forEach(card => {
                            card.element.classList.remove('flipped');
                            card.element.classList.add('matched');
                        });
                        matchedPairs++;
                        document.getElementById('pairs').textContent = `${matchedPairs} / ${totalPairs}`;
                        flippedCards = [];
                        canFlip = true;

                        if (matchedPairs === totalPairs) {
                            setTimeout(() => {
                                playSound('win');
                                document.getElementById('finalMoves').textContent = moves;
                                document.getElementById('memCongrats').style.display = 'block';
                            }, 500);
                        }
                    }, 500);
                } else {
                    setTimeout(() => {
                        flippedCards.forEach(card => {
                            card.element.classList.remove('flipped');
                            if (card.type === 'emoji') {
                                card.element.textContent = '';
                            }
                        });
                        flippedCards = [];
                        canFlip = true;
                    }, 1000);
                }
            }
        }

        // ===== WORD SEARCH SETUP =====
        function setWordMode(mode) {
            wordMode = mode;
            document.getElementById('themeModeBtn').classList.toggle('active', mode === 'theme');
            document.getElementById('photoWordModeBtn').classList.toggle('active', mode === 'photos');
            
            document.getElementById('themeSection').style.display = mode === 'theme' ? 'block' : 'none';
            document.getElementById('photoWordSection').style.display = mode === 'photos' ? 'block' : 'none';
            
            updateStartWordButton();
        }

        function setWordDifficulty(level) {
            wordDifficulty = level;
            gridSize = level === 'easy' ? 6 : 8;
            document.getElementById('wordEasyBtn').classList.toggle('active', level === 'easy');
            document.getElementById('wordMediumBtn').classList.toggle('active', level === 'medium');
            
            updateWordPhotoSlots();
            updateStartWordButton();
        }

        function setTheme(theme) {
            wordTheme = theme;
            document.getElementById('themeAnimals').classList.toggle('active', theme === 'animals');
            document.getElementById('themeFruits').classList.toggle('active', theme === 'fruits');
            document.getElementById('themeFamily').classList.toggle('active', theme === 'family');
            document.getElementById('themeNature').classList.toggle('active', theme === 'nature');
        }

        function updateWordPhotoSlots() {
            const maxPhotos = wordDifficulty === 'easy' ? 4 : 6;
            document.getElementById('maxWordPhotos').textContent = maxPhotos;
            
            const grid = document.getElementById('wordPhotoGrid');
            grid.innerHTML = '';
            
            for (let i = 0; i < maxPhotos; i++) {
                const slot = document.createElement('div');
                slot.className = 'photo-slot';
                
                if (uploadedWordPhotos[i]?.image) {
                    slot.classList.add('filled');
                    slot.innerHTML = `
                        <div class="photo-preview">
                            <img src="${uploadedWordPhotos[i].image}" alt="Photo ${i + 1}">
                        </div>
                        <input type="text" class="photo-label-input" placeholder="Enter name..." 
                               value="${uploadedWordPhotos[i].label || ''}" 
                               onchange="updateWordPhotoLabel(${i}, this.value)"
                               onclick="event.stopPropagation()">
                        <button class="remove-photo" onclick="removeWordPhoto(${i})">√ó</button>
                    `;
                } else {
                    slot.innerHTML = `
                        <div class="photo-slot-content">
                            <div class="icon">üì∑</div>
                            <div>Add Photo ${i + 1}</div>
                        </div>
                    `;
                }
                
                slot.onclick = () => triggerWordFileUpload(i);
                grid.appendChild(slot);
            }
            updateWordPhotoCount();
        }

        function triggerWordFileUpload(index) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = (e) => handleWordPhotoUpload(e, index);
            input.click();
        }

        function handleWordPhotoUpload(event, index) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                while (uploadedWordPhotos.length <= index) {
                    uploadedWordPhotos.push(null);
                }
                if (!uploadedWordPhotos[index]) {
                    uploadedWordPhotos[index] = {};
                }
                uploadedWordPhotos[index].image = e.target.result;
                updateWordPhotoSlots();
                updateStartWordButton();
            };
            reader.readAsDataURL(file);
        }

        function updateWordPhotoLabel(index, label) {
            while (uploadedWordPhotos.length <= index) {
                uploadedWordPhotos.push(null);
            }
            if (!uploadedWordPhotos[index]) {
                uploadedWordPhotos[index] = {};
            }
            uploadedWordPhotos[index].label = label.toUpperCase().replace(/[^A-Z]/g, '');
            updateWordPhotoSlots();
            updateStartWordButton();
        }

        function removeWordPhoto(index) {
            event.stopPropagation();
            while (uploadedWordPhotos.length <= index) {
                uploadedWordPhotos.push(null);
            }
            uploadedWordPhotos[index] = null;
            updateWordPhotoSlots();
            updateStartWordButton();
        }

        function updateWordPhotoCount() {
            const count = uploadedWordPhotos.filter(p => p?.image).length;
            document.getElementById('wordPhotoCount').textContent = count;
        }

        function updateStartWordButton() {
            const btn = document.getElementById('startWordBtn');
            const requiredPhotos = wordDifficulty === 'easy' ? 4 : 6;
            
            if (wordMode === 'photos') {
                const validPhotos = uploadedWordPhotos.filter(p => p?.image && p?.label && p.label.length > 0);
                btn.disabled = validPhotos.length < requiredPhotos;
                btn.textContent = validPhotos.length < requiredPhotos ? 
                    `Upload ${requiredPhotos} photos with names` : 'Start Game';
            } else {
                btn.disabled = false;
                btn.textContent = 'Start Game';
            }
        }

        function saveWordPhotoSet() {
            const validPhotos = uploadedWordPhotos.filter(p => p?.image);
            if (validPhotos.length === 0) {
                alert('Please upload some photos first!');
                return;
            }
            
            try {
                const dataStr = JSON.stringify(uploadedWordPhotos);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'word-search-photos.json';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                alert('Photo set saved successfully! Check your downloads folder.');
            } catch (error) {
                alert('Error saving photo set: ' + error.message);
            }
        }

        function loadWordPhotoSet() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        uploadedWordPhotos = data;
                        updateWordPhotoSlots();
                        updateStartWordButton();
                        alert('Photo set loaded successfully!');
                    } catch (error) {
                        alert('Error loading photo set: ' + error.message);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // ===== WORD SEARCH GAME LOGIC =====
        function startWordSearch() {
            document.getElementById('wordSearchSetupScreen').classList.remove('active');
            document.getElementById('wordSearchScreen').classList.add('active');
            initWordSearch();
        }

        function initWordSearch() {
            foundWords = [];
            selectedCells = [];
            document.getElementById('wordCongrats').style.display = 'none';

            const wordCount = wordDifficulty === 'easy' ? 4 : 6;
            
            if (wordMode === 'photos') {
                const validPhotos = uploadedWordPhotos.filter(p => p?.image && p?.label && p.label.length > 0);
                wordPhotos = validPhotos.slice(0, wordCount);
                words = wordPhotos.map(p => p.label);
            } else {
                const themeWords = themes[wordTheme];
                words = themeWords.slice(0, wordCount);
                wordPhotos = [];
            }

            grid = Array(gridSize).fill().map(() => Array(gridSize).fill(''));

            words.forEach(word => placeWord(word));

            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    if (grid[i][j] === '') {
                        grid[i][j] = String.fromCharCode(65 + Math.floor(Math.random() * 26));
                    }
                }
            }

            renderGrid();
            renderWordList();
            updateWordCount();
        }

        function placeWord(word) {
            const directions = [
                [0, 1],
                [1, 0],
                [1, 1],
            ];

            let placed = false;
            let attempts = 0;

            while (!placed && attempts < 100) {
                const direction = directions[Math.floor(Math.random() * directions.length)];
                const row = Math.floor(Math.random() * gridSize);
                const col = Math.floor(Math.random() * gridSize);

                if (canPlaceWord(word, row, col, direction)) {
                    for (let i = 0; i < word.length; i++) {
                        grid[row + i * direction[0]][col + i * direction[1]] = word[i];
                    }
                    placed = true;
                }
                attempts++;
            }
        }

        function canPlaceWord(word, row, col, direction) {
            for (let i = 0; i < word.length; i++) {
                const newRow = row + i * direction[0];
                const newCol = col + i * direction[1];

                if (newRow >= gridSize || newCol >= gridSize) return false;
                if (grid[newRow][newCol] !== '' && grid[newRow][newCol] !== word[i]) return false;
            }
            return true;
        }

        function renderGrid() {
            const gridEl = document.getElementById('wordGrid');
            gridEl.innerHTML = '';
            gridEl.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;

            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'word-cell';
                    cell.textContent = grid[i][j];
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    
                    cell.addEventListener('mousedown', startSelection);
                    cell.addEventListener('mouseenter', continueSelection);
                    cell.addEventListener('mouseup', endSelection);
                    cell.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        startSelection.call(cell);
                    });
                    cell.addEventListener('touchmove', (e) => {
                        e.preventDefault();
                        const touch = e.touches[0];
                        const element = document.elementFromPoint(touch.clientX, touch.clientY);
                        if (element && element.classList.contains('word-cell')) {
                            continueSelection.call(element);
                        }
                    });
                    cell.addEventListener('touchend', endSelection);
                    
                    gridEl.appendChild(cell);
                }
            }
        }

        function startSelection(e) {
            isSelecting = true;
            selectedCells = [];
            clearSelection();
            this.classList.add('selected');
            selectedCells.push({ row: parseInt(this.dataset.row), col: parseInt(this.dataset.col), el: this });
        }

        function continueSelection(e) {
            if (!isSelecting) return;
            
            const row = parseInt(this.dataset.row);
            const col = parseInt(this.dataset.col);
            
            if (!selectedCells.some(c => c.row === row && c.col === col)) {
                this.classList.add('selected');
                selectedCells.push({ row, col, el: this });
            }
        }

        function endSelection(e) {
            if (!isSelecting) return;
            isSelecting = false;
            checkWord();
        }

        function clearSelection() {
            document.querySelectorAll('.word-cell.selected').forEach(cell => {
                if (!cell.classList.contains('found')) {
                    cell.classList.remove('selected');
                }
            });
        }

        function checkWord() {
            const selectedWord = selectedCells.map(c => grid[c.row][c.col]).join('');
            const reversedWord = selectedWord.split('').reverse().join('');

            if (words.includes(selectedWord) && !foundWords.includes(selectedWord)) {
                markWordFound(selectedWord);
            } else if (words.includes(reversedWord) && !foundWords.includes(reversedWord)) {
                markWordFound(reversedWord);
            } else {
                clearSelection();
            }
            selectedCells = [];
        }

        function markWordFound(word) {
            foundWords.push(word);
            selectedCells.forEach(cell => {
                cell.el.classList.remove('selected');
                cell.el.classList.add('found');
            });
            
            document.querySelector(`[data-word="${word}"]`).classList.add('found');
            updateWordCount();

            if (foundWords.length === words.length) {
                setTimeout(() => {
                    document.getElementById('totalWords').textContent = words.length;
                    document.getElementById('wordCongrats').style.display = 'block';
                }, 500);
            }
        }

        function renderWordList() {
            const listEl = document.getElementById('wordList');
            listEl.innerHTML = '';
            
            words.forEach((word, index) => {
                const li = document.createElement('li');
                li.className = 'word-item';
                li.dataset.word = word;
                
                if (wordMode === 'photos' && wordPhotos[index]) {
                    const img = document.createElement('img');
                    img.src = wordPhotos[index].image;
                    li.appendChild(img);
                }
                
                const textDiv = document.createElement('div');
                textDiv.className = 'word-item-text';
                textDiv.textContent = word;
                li.appendChild(textDiv);
                
                listEl.appendChild(li);
            });
        }

        function updateWordCount() {
            document.getElementById('wordsFound').textContent = foundWords.length;
            document.getElementById('totalWordsDisplay').textContent = words.length;
        }
    </script>
</body>
</html>
